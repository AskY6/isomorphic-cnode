(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{374:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"initialState",function(){return T}),n.d(r,"COMPONENT_WILL_CREATE",function(){return P}),n.d(r,"TOGGLE_REPLY_FORM",function(){return N}),n.d(r,"SHOW_REPLY_FORM",function(){return j}),n.d(r,"HIDE_REPLY_FORM",function(){return x}),n.d(r,"LIKE_REPLY",function(){return S}),n.d(r,"REPLY_TO_TOPIC",function(){return C}),n.d(r,"REPLY_TO_OTHER",function(){return A}),n.d(r,"ADD_REPLY",function(){return M});var a=n(364),o=n(1),c=n.n(o),i=n(48),l=n.n(i),u=n(23),s=n(367),p=n(366),f=n(365),m=n(363);function d(e){var t=e.state,n=e.handlers,r=t.isLogin,a=t.topic,o=t.activeReplyId,i=t.replyOfOthers;Object(s.useCtrl)(),Object(s.useModel)(),Object(s.useActions)();return a?c.a.createElement(m.a,null,c.a.createElement("div",{id:"page"},c.a.createElement("h2",{className:"topic-title"},a.title),c.a.createElement(b,{topic:a}),c.a.createElement(y,{content:a.content}),c.a.createElement(h,{count:a.reply_count}),c.a.createElement(g,{if:r,id:-1,name:"replyOfTopic",onSubmit:n.handleReplyTopic}),c.a.createElement(O,{replies:a.replies,replyOfOthers:i,activeReplyId:o,isLogin:r,handlers:n}))):c.a.createElement(m.a,null,c.a.createElement(v,null),";")}var y=Object(p.b)()(function(e){var t=e.content;return c.a.createElement("section",{className:"markdown-body topic-content",dangerouslySetInnerHTML:{__html:t}})});function h(e){var t=e.count;return c.a.createElement("h3",{className:"topic-reply"},c.a.createElement("strong",null,t)," \u56de\u590d")}function v(){return c.a.createElement("div",{style:{height:"100%",background:"#fff"}},c.a.createElement("div",{className:"no-data"},c.a.createElement("i",{className:"iconfont icon-empty"},"\ue60a"),"\u8be5\u8bdd\u9898\u4e0d\u5b58\u5728!"))}function b(e){var t,n,r,a=e.topic,o=l()((t={tag:!0},n=f.b(a.tab,a.good,a.top),r=!0,n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t));return c.a.createElement("section",{className:"author-info"},c.a.createElement(u.Link,{as:"img",className:"avatar",src:a.author.avatar_url,to:"/user/".concat(a.author.loginname)}),c.a.createElement("div",{className:"col"},c.a.createElement("span",null,a.author.loginname),c.a.createElement("time",null,"\u53d1\u5e03\u4e8e:",f.a(a.create_at,!0))),c.a.createElement("div",{className:"right"},c.a.createElement("span",{className:o},f.c(a.tab,a.good,a.top)),c.a.createElement("span",{className:"name"},a.visit_count,"\u6b21\u6d4f\u89c8")))}function g(e){if(!e.if)return null;var t=e.id,n=e.name,r=e.onSubmit;return c.a.createElement("section",{className:"reply"},c.a.createElement(u.Input,{as:"textarea",name:n,rows:"8",className:"text",placeholder:"\u56de\u590d\u652f\u6301Markdown\u8bed\u6cd5,\u8bf7\u6ce8\u610f\u6807\u8bb0\u4ee3\u7801"}),c.a.createElement("button",{className:"button",onClick:r,"data-id":t},"\u786e\u5b9a"))}function O(e){var t=e.replies,n=e.replyOfOthers,r=e.activeReplyId,a=e.isLogin,o=e.handlers;return c.a.createElement("section",{className:"reply-list"},c.a.createElement("ul",null,t.map(function(e){return c.a.createElement(E,{key:e.id,reply:e,replyContent:n[e.id],showReplyForm:a&&r===e.id,handlers:o})})))}var E=Object(p.a)()(function(e){var t=e.reply,n=e.replyContent,r=e.handlers,a=e.showReplyForm;return c.a.createElement("li",null,c.a.createElement("section",{className:"user"},c.a.createElement(u.Link,{as:"img",className:"head",src:t.author.avatar_url,to:"/user/".concat(t.author.loginname)}),c.a.createElement("div",{className:"info"},c.a.createElement("span",{className:"cl"},c.a.createElement("span",{className:"name"},t.author.loginname),c.a.createElement("span",{className:"name mt10"},c.a.createElement("span",null),"\u53d1\u5e03\u4e8e:",f.a(t.create_at,!0))),c.a.createElement("span",{className:"cr"},c.a.createElement(R,{id:t.id,like:t.isUps,onClick:r.handleLikeReply}),t.ups.length,c.a.createElement(w,{id:t.id,onClick:r.handleToggleReplyForm})))),c.a.createElement("div",{className:"reply_content",dangerouslySetInnerHTML:{__html:t.content}}),c.a.createElement(g,{if:a,id:t.id,name:"replyOfOthers.".concat(t.id),value:n,onSubmit:r.handleReplyOther}))});function R(e){var t=e.id,n=e.like,r=e.onClick,a=l()({iconfont:!0,icon:!0,uped:n});return c.a.createElement("span",{className:a,onClick:r,"data-id":t},"\ue608")}function w(e){var t=e.id,n=e.onClick;return c.a.createElement("span",{className:"iconfont icon",onClick:n,"data-id":t},"\ue609")}var k=n(103),_=n(368);function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){I(e,t,n[t])})}return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T={pageTitle:"\u8be6\u60c5",topic:null,activeReplyId:null,replyOfOthers:{},replyOfTopic:""},P=function(e,t){var n=t.topic;return n&&(e=Object(k.UPDATE_HTML_TITLE)(e,n.title)),L({},e,{topic:n})},N=function(e,t){var n=t.activeReplyId;return n===e.activeReplyId?x(e):j(e,n)},j=function(e,t){var n=e.replyOfOthers;if(!n[t]){n=L({},n);var r=e.topic.replies.find(function(e){return e.id===t});n[t]="@".concat(r.author.loginname," ")}return L({},e,{activeReplyId:t,replyOfOthers:n})},x=function(e){return L({},e,{activeReplyId:null})},S=function(e,t){var n=t.action,r=t.replyId,a=e.topic,o=e.userInfo,c=(o.token,o.id),i=a.replies.map(function(e){if(e.id!==r)return e;var t=e.ups;return"down"===n?t=t.filter(function(e){return e!==c}):"up"===n&&(t=t.concat(c)),L({},e,{ups:t})});return a=L({},a,{replies:i}),L({},e,{topic:a})},C=function(e,t){return L({},e=M(e,t),{replyOfTopic:""})},A=function(e,t){var n=t.replyId,r=t.newReplyId,a=t.content,o=L({},(e=M(e,{replyId:r,content:a})).replyOfOthers,I({},n,""));return L({},e,{replyOfOthers:o})},M=function(e,t){var n=t.replyId,r=t.content,a=e.userInfo,o=e.topic,c=function(e){var t=e.replyId,n=e.content,r=e.userInfo,a=(new Date).getTime();return{id:t,author:{loginname:r.loginname,avatar_url:r.avatar_url},content:_.markdown.toHTML(n),ups:[],create_at:a}}({replyId:n,content:r,userInfo:a});return o=L({},o,{replies:o.replies.concat(c)}),L({},e,{topic:o})};function Y(e){return(Y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){U(e,t,n[t])})}return e}function H(e,t,n,r,a,o,c){try{var i=e[o](c),l=i.value}catch(u){return void n(u)}i.done?t(l):Promise.resolve(l).then(r,a)}function D(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){H(o,r,a,c,i,"next",e)}function i(e){H(o,r,a,c,i,"throw",e)}c(void 0)})}}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"default",function(){return V});var V=function(e){function t(){var e,n,a,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return a=this,o=(e=W(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==Y(o)&&"function"!==typeof o?J(a):o,U(J(J(n)),"KeepAlive",!0),U(J(J(n)),"View",d),U(J(J(n)),"Model",r),U(J(J(n)),"handleToggleReplyForm",function(e){var t=e.currentTarget;n.checkLogin()&&(0,n.store.actions.TOGGLE_REPLY_FORM)({activeReplyId:t.getAttribute("data-id")})}),U(J(J(n)),"handleLikeReply",function(){var e=D(regeneratorRuntime.mark(function e(t){var r,a,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.currentTarget,n.checkLogin()){e.next=3;break}return e.abrupt("return");case 3:return a=n.store.actions.LIKE_REPLY,o=r.getAttribute("data-id"),e.prev=5,e.next=8,n.likeReply(o);case 8:c=e.sent,i=c.action,a({action:i,replyId:o}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),n.showAlert(e.t0.message);case 16:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}()),U(J(J(n)),"handleReplyTopic",function(){var e=D(regeneratorRuntime.mark(function e(t){var r,a,o,c,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.currentTarget,n.checkLogin()){e.next=3;break}return e.abrupt("return");case 3:return r=n.store.actions.REPLY_TO_TOPIC,a=n.store.getState(),o={content:a.replyOfTopic},n.showLoading("\u56de\u590d\u4e2d\u2026\u2026"),e.prev=7,e.next=10,n.postReply(o);case 10:c=e.sent,i=c.reply_id,l=c.content,r({replyId:i,content:l}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(7),n.showAlert(e.t0.message);case 18:n.hideLoading();case 19:case"end":return e.stop()}},e,this,[[7,15]])}));return function(t){return e.apply(this,arguments)}}()),U(J(J(n)),"handleReplyOther",function(){var e=D(regeneratorRuntime.mark(function e(t){var r,a,o,c,i,l,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.currentTarget,n.checkLogin()){e.next=3;break}return e.abrupt("return");case 3:return a=n.store.actions.REPLY_TO_OTHER,o=n.store.getState(),c=r.getAttribute("data-id"),i={replyId:c,content:o.replyOfOthers[c]},n.showLoading("\u56de\u590d\u4e2d\u2026\u2026"),e.prev=8,e.next=11,n.postReply(i);case 11:l=e.sent,u=l.reply_id,s=l.content,a({replyId:c,newReplyId:u,content:s}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),n.showAlert(e.t0.message);case 19:n.hideLoading();case 20:case"end":return e.stop()}},e,this,[[8,16]])}));return function(t){return e.apply(this,arguments)}}()),n}var n,o,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,a["a"]),n=t,(o=[{key:"componentWillCreate",value:function(){var e=D(regeneratorRuntime.mark(function e(){var t,n,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.store.actions.COMPONENT_WILL_CREATE,n=this.store.getState(),r=n.location.params.topicId,e.prev=3,e.next=6,this.get("/topic/".concat(r));case 6:a=e.sent,o=a.data,t({topic:o}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),t({topic:null});case 14:case"end":return e.stop()}},e,this,[[3,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"checkLogin",value:function(){return!!this.isLogin()||(this.history.push("/login?redirect=".concat(this.location.raw)),!1)}},{key:"likeReply",value:function(e){var t="/reply/".concat(e,"/ups"),n=this.cookie("accesstoken");return this.post(t,{accesstoken:n})}},{key:"postReply",value:function(){var e=D(regeneratorRuntime.mark(function e(t){var n,r,a,o,c,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.content,r=t.replyId,n&&!(n.length<=10)){e.next=3;break}throw new Error("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u5c11\u4e8e10\u4e2a\u5b57");case 3:return n=f.e(n)+"\n\u6765\u81ea [isomorphic-cnode](https://lucifier129.github.io/isomorphic-cnode/publish/static/)",a=this.location.params.topicId,o="/topic/".concat(a,"/replies"),c=this.cookie("accesstoken"),i={accesstoken:c,content:n},r&&(i.reply_id=r),e.next=11,this.post(o,i);case 11:return l=e.sent,e.abrupt("return",F({},l,{content:n}));case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}])&&G(n.prototype,o),c&&G(n,c),t}()}}]);